angular.module('app').controller('eventBookingCtl',['$scope','$state','$rootScope','Business','$rootScope','EventCategory','Events','EventDates','EventTicketType','EventTicketGroup','EventBooking',function($scope,$state,$rootScope,Business,$rootScope,EventCategory,Events,EventDates,EventTicketType,EventTicketGroup,EventBooking){$scope.isBusinessSelect=!1;toastMsg=(isVaild,msg)=>{if(isVaild)
    toastr.success(msg);else toastr.error(msg);toastr.options={"closeButton":!0,"progressBar":!0,"timeOut":"5000"}}
    if(!$scope.userId)$scope.userId=$rootScope.currentUser.id;$scope.useremail=$rootScope.currentUser.email;$scope.userId="";if($rootScope&&$rootScope.currentUser&&$rootScope.currentUser.email=="admin@barm8.com.au"){$scope.isBusinessSelect=!0;Business.find({filter:{where:{status:"approved"},"fields":["businessName","id","email"]}}).$promise.then((res)=>{$scope.businessDelection=res;$scope.userId=$rootScope.currentUser.id},(err)=>{console.log(JSON.stringify())})}
    else{$scope.isBusinessSelect=!0;$scope.userId=$rootScope.currentUser.id}
    $scope.getBusinessName=()=>{return $scope.businessDelection};$scope.events=[];$scope.ticketTypes=[];$scope.ticketgroups=[];$scope.getEventCategory=()=>{$scope.events=[];$scope.ticketTypes=[];Events.find({filter:{where:{ownerId:$scope.userId},fields:["id","title"]}}).$promise.then((res)=>{$scope.events=res});EventTicketType.find({filter:{where:{ownerId:$scope.userId}}}).$promise.then((res)=>{$scope.ticketTypes=res});EventTicketGroup.find({filter:{where:{ownerId:$scope.userId}}}).$promise.then((res)=>{$scope.ticketgroups=res})};$scope.BusinessSelected=(arg)=>{$("#businessErr").text('');if(arg!=""){if(arg=='BusinessManager'){if($("#autocompleteBusiness").data('id')){$scope.userId=$("#autocompleteBusiness").data('id');$scope.getEventCategory();if($("#businessSubmit").hasClass('businessSubmit')){$("#businessSubmit").html('<i class="fa fa-check" aria-hidden="true"></i>&nbsp;&nbsp;Reset').removeClass('businessSubmit').addClass('businessReset')}}else{$("#businessErr").text('Please select the Business name')}}}}
    $scope.eventBooking=[];$scope.searchClk=()=>{if(!$scope.eventId||$scope.eventId=="select")$scope.eventId=undefined;if(!$scope.eventTicketGroupId||$scope.eventTicketGroupId=="select")$scope.eventTicketGroupId=undefined;if(!$scope.eventTicketTypeId||$scope.eventTicketTypeId=="select")$scope.eventTicketTypeId=undefined;EventDates.findOne({filter:{where:{eventsId:$scope.eventId},include:[{relation:"eventBookings",scope:{where:{or:[{eventTicketTypeId:$scope.eventTicketTypeId},{eventTicketGroupId:$scope.eventTicketGroupId}]},include:[{relation:"customer"},{relation:"eventPayments"}]}}]}}).$promise.then((res)=>{if(res&&res.eventBookings){$scope.eventBooking=res.eventBookings}})};$scope.viewBooking=(id)=>{if(id){$scope.bookingDetails={};EventBooking.findOne({filter:{where:{id},include:[{relation:"customer"},{relation:"events"},{relation:"eventDates"},{relation:"eventTicketGroup"},{relation:"eventTicketType"},{relation:"eventPayments"}]}}).$promise.then((res)=>$scope.bookingDetails=res);$('#eventBookingView').modal({backdrop:'static',keyboard:!1})}else toastMsg(!1,"Please try again")}}])