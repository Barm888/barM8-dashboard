angular.module('app').controller('ScanVIPListCtl',['$scope','Business','$http','AuthService','$state','$rootScope','UserLoginDetails','LoyaltyLines',function($scope,Business,$http,AuthService,$state,$rootScope,UserLoginDetails,LoyaltyLines){if(!$scope.userId){$scope.userId=$rootScope.currentUser.id}
$scope.ownerId;$scope.useremail=$rootScope.currentUser.email;$scope.userId="";$scope.isBusinessSelected=!1;if($rootScope.currentUser.email=="admin@barm8.com.au"){Business.find({filter:{where:{status:"approved"},"fields":["businessName","id","email"]}}).$promise.then((res)=>{$scope.businessDelection=res;$scope.userId=$rootScope.currentUser.id},(err)=>{console.log(JSON.stringify())})}
else{$scope.userId=$rootScope.currentUser.id}
$scope.getBusinessName=()=>{return $scope.businessDelection};$scope.loyaltyDetails=[];$scope.bronzeCnt=0;$scope.silverCnt=0;$scope.goldCnt=0;$scope.platinumCnt=0;$scope.vipCnt=0;$scope.getloyalty=()=>{if($scope.ownerId){LoyaltyLines.find({filter:{where:{ownerId:$scope.ownerId},include:{relation:'customer'}}}).$promise.then((res)=>{if(res&&res.length>0){$scope.loyaltyDetails=res.filter(m=>m.customer);$scope.bronzeCnt=($scope.loyaltyDetails.filter(m=>m.level=='Bronze')).length;$scope.silverCnt=($scope.loyaltyDetails.filter(m=>m.level=='Silver')).length;$scope.goldCnt=($scope.loyaltyDetails.filter(m=>m.level=='Gold')).length;$scope.platinumCnt=($scope.loyaltyDetails.filter(m=>m.level=='Platinum')).length;$scope.vipCnt=($scope.loyaltyDetails.filter(m=>m.level=='VIP')).length}})}};$scope.BusinessSelected=(arg)=>{$("#businessErr").text('');if(arg=='scans'){if($("#autocompleteBusiness").data('id')){$scope.ownerId=$("#autocompleteBusiness").data('id');arg=$("#autocompleteBusiness").data('id');$scope.getloyalty();$scope.isBusinessSelected=!0;if($("#businessSubmit").hasClass('businessSubmit')){$("#businessSubmit").html('<i class="fa fa-check" aria-hidden="true"></i>&nbsp;&nbsp;Reset');$("#businessSubmit").removeClass('businessSubmit').addClass('businessReset')}}else{$("#businessErr").text('Please select the Business name')}}}}])