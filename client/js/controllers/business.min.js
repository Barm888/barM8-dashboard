angular.module('app').controller('BusinessController', ['$scope', '$state', 'Business', 'Category', '$http', function ($scope, $state, Business, Category, $http) {
$scope.businesses = []; $scope.businessActive = !0; $scope.appendBusiness = []; $scope.pendingBusiness = []; $scope.businessPending = () => { Business.find({ filter: { where: { status: "pending" }, fields: ["id", "businessName", "phone", "email", "status", "state"], order: "businessName ASC" } }).$promise.then(function (pendingRes) { $scope.pendingBusiness = pendingRes }, function (err) { console.log(JSON.stringify(err)) }) }
    $scope.updateGiveaway = (businessId, businessName) => { var checkBox = document.getElementById(`${businessId}`); if (checkBox.checked == !0) { document.getElementById(`sp${businessId}`).innerHTML = "On"; Business.upsertWithWhere({ where: { id: businessId } }, { "instantGiveaway": "On" }).$promise.then(function (updateRes) { }, function (err) { console.log(JSON.stringify(err)) }) } else { document.getElementById(`sp${businessId}`).innerHTML = "Off"; Business.upsertWithWhere({ where: { id: businessId } }, { "instantGiveaway": "Off" }).$promise.then(function (updateRes) { }, function (err) { console.log(JSON.stringify(err)) }) } }
    $scope.updateSubscription = (businessId) => { var checkBox = document.getElementById(`${businessId}`); if (checkBox.checked == !0) { document.getElementById(`sp${businessId}`).innerHTML = "On"; Business.upsertWithWhere({ where: { id: businessId } }, { "subscription": "yes" }).$promise.then(function (updateRes) { }, function (err) { console.log(JSON.stringify(err)) }) } else { document.getElementById(`sp${businessId}`).innerHTML = "Off"; Business.upsertWithWhere({ where: { id: businessId } }, { "subscription": "no" }).$promise.then(function (updateRes) { }, function (err) { console.log(JSON.stringify(err)) }) } }
    $scope.businessPending(); $scope.searchSubmit = () => {
        $("#preloader").css('display', 'block'); $scope.appendBusiness = []; $scope.isActive = "approved"; if (!$scope.businessActive) { $scope.isActive = "pending" }
        var filter; if (($scope.stateFilter != undefined && $scope.stateFilter != null && $scope.stateFilter != "") && ($scope.businessNameFilter !== undefined && $scope.businessNameFilter != null && $scope.businessNameFilter != "")) { filter = { "filter": { "where": { "and": [{ "or": [{ "businessName": { "like": "" + $scope.businessNameFilter + ".*", "options": "i" } }, { "state": { "like": "" + $scope.stateFilter + ".*", "options": "i" } }, { "status": $scope.isActive }] }] }, "fields": ["id", "businessName", "phone", "email", "status", "state", "instantGiveaway", "subscription"], "order": "businessName ASC" } } } else if (($scope.stateFilter != undefined && $scope.stateFilter != null && $scope.stateFilter != "") && ($scope.businessNameFilter == undefined || $scope.businessNameFilter == null || $scope.businessNameFilter == "")) { filter = { "filter": { "where": { "and": [{ "state": { "like": "" + $scope.stateFilter + ".*", "options": "i" } }, { "status": $scope.isActive }] }, "fields": ["id", "businessName", "phone", "email", "status", "state", "instantGiveaway", "subscription"], "order": "businessName ASC" } } } else if (($scope.businessNameFilter != undefined && $scope.businessNameFilter != null && $scope.businessNameFilter != "") && ($scope.stateFilter == undefined || $scope.stateFilter == null || $scope.stateFilter == "")) { filter = { "filter": { "where": { "and": [{ "businessName": { "like": "" + $scope.businessNameFilter + ".*", "options": "i" } }, { "status": $scope.isActive }] }, "fields": ["id", "businessName", "phone", "email", "status", "state", "instantGiveaway", "subscription"], "order": "businessName ASC" } } } else { filter = { "filter": { "where": { "status": $scope.isActive }, "fields": ["id", "businessName", "phone", "email", "status", "state", "instantGiveaway", "subscription"], "order": "businessName ASC" } } }
        $scope.fPage = 0; $scope.lPage = 19; $scope.currentpage = 0; $scope.nextButton = !1; $scope.preButton = !1; $scope.appendBusinessStock = []; Business.find(filter).$promise.then(function (res) {
            $("#preloader").css('display', 'none'); $scope.appendBusinessStock = res; if ($scope.appendBusinessStock.length > 0) {
            $scope.pageNationCntArray = []; console.log(res.length)
                var pLength = Math.floor((res.length) / 19); console.log(pLength); $scope.currentpage = 1; for (var i = 0; i < pLength; i++) { $scope.pageNationCntArray.push((i + 1)) }
                for (var j = $scope.fPage; j <= $scope.lPage; j++) { $scope.appendBusiness.push(res[j]); if (j == (res.length - 1)) { break } }
            }
        }, function (err) { console.log(JSON.stringify(err)) }); $scope.pClk = (arg) => {
        $scope.currentpage = arg; $scope.fPage = (($scope.currentpage - 1) * 20); console.log($scope.fPage); $scope.lPage = ($scope.fPage + 20); console.log($scope.lPage); if ($scope.appendBusinessStock.length <= $scope.lPage) { $scope.nextButton = !0 } else { $scope.nextButton = !1 }
            if (1 <= $scope.fPage) { $scope.preButton = !1 }
            $scope.appendBusiness = []; for (var j = $scope.fPage; j < $scope.lPage; j++) { $scope.appendBusiness.push($scope.appendBusinessStock[j]); if (j == ($scope.appendBusinessStock.length - 1)) { break } }
        }; $scope.prevoiusClk = () => {
            console.log($scope.currentpage); if ($scope.currentpage == 0) { $scope.currentpage = 1 }
            if ($scope.currentpage <= 2) { $scope.currentpage--; $scope.fPage = 0; $scope.lPage = ((($scope.currentpage) * 20) - 1) } else { $scope.currentpage--; $scope.fPage = (($scope.currentpage * 20) - 1); $scope.lPage = ((($scope.currentpage + 1) * 20) - 1) }
            if ($scope.lPage <= $scope.appendBusinessStock.length) { $scope.nextButton = !1 }
            console.log($scope.fPage); console.log($scope.lPage); if (1 >= $scope.fPage || $scope.currentpage == 1) { $scope.preButton = !0 }
            $scope.appendBusiness = []; for (var j = $scope.fPage; j < $scope.lPage; j++) { $scope.appendBusiness.push($scope.appendBusinessStock[j]); if (j == ($scope.appendBusinessStock.length - 1)) { break } }
        }; $scope.nextClk = () => {
            if ($scope.currentpage == 0) { $scope.currentpage = 1 }
            $scope.fPage = (($scope.currentpage * 20) - 1); console.log($scope.fPage); $scope.lPage = ((($scope.currentpage + 1) * 20) - 1); console.log($scope.lPage); $scope.currentpage++; $scope.appendBusiness = []; if ($scope.appendBusinessStock.length <= $scope.lPage) { $scope.nextButton = !0 } else { $scope.nextButton = !1 }
            if (1 <= $scope.fPage) { $scope.preButton = !1 }
            for (var j = $scope.fPage; j < $scope.lPage; j++) { $scope.appendBusiness.push($scope.appendBusinessStock[j]); if (j == ($scope.appendBusinessStock.length - 1)) { break } }
        }
    }
    if ($scope.currentUser.email) {
        if ($scope.currentUser.email == 'admin@barm8.com.au') { } else {
        $scope.businessApproved = function () { Business.find({ "filter": { "where": { "and": [{ "status": "approved" }, { id: $scope.currentUser.id }] }, "fields": ["id", "businessName", "phone", "email", "status", "state"], "order": "businessName ASC" } }).$promise.then(function (approvedRes) { $scope.appendBusiness = approvedRes }, function (err) { console.log(JSON.stringify(err)) }) }
            $scope.businessApproved()
        }
    } else { $scope.appendBusiness = [] }
    $scope.categorys = []; function getCategorys() { Category.find().$promise.then(function (results) { $scope.categorys = results }) }
    getCategorys(); $scope.addBusiness = function () { Business.create($scope.newBusiness).$promise.then(function (business) { $scope.newBusiness = {}; $scope.searchSubmit(); $state.go('business') }) }; $scope.approveBusiness = function (item) { var status = ""; if (item.status == "pending") { status = "approved" } else { status = "pending" } }; $scope.businessDelete = (id, businessName) => { $scope.deleteId = id; $("#msgTxt").text(`Do you want delete ${businessName} ?`); $("#msgShow").modal({ backdrop: 'static', keyboard: !1 }) }; $scope.removeBusiness = function (item) { Business.deleteById({ id: item }).$promise.then(function (res) { if (res.count == 1) { $scope.searchSubmit() } }) }
}]).controller('EditBusinessPromotionController', ['$scope', 'Business', 'Promotion', '$state', '$stateParams', function ($scope, Business, Promotion, $state, $stateParams) { Promotion.findById({ id: $stateParams.id }).$promise.then(function (promotion) { $scope.promotion = promotion; $state.go('edit-businesspromotion') }); $scope.business = {}; $scope.saveBusinessPromotion = function (item) { Promotion.replaceById(item).$promise.then(function () { $state.go('business') }) } }])